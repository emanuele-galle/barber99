{"name":"Barber99 - Email Booking","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"barber99-booking"},"id":"webhook-trigger","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[200,400],"webhookId":"7afc59bd-fe65-4529-a609-48505ae7165c"},{"parameters":{"conditions":{"combinator":"and","conditions":[{"id":"cond-if-reminder","leftValue":"={{ $json.body.event }}","rightValue":"manual_reminder","operator":{"type":"string","operation":"equals"}}],"options":{"caseSensitive":false,"leftValue":"","typeValidation":"loose"}}},"id":"if-reminder","name":"Is Reminder?","type":"n8n-nodes-base.if","typeVersion":2,"position":[400,400]},{"parameters":{"conditions":{"combinator":"and","conditions":[{"id":"cond-if-cancel","leftValue":"={{ $json.body.event }}","rightValue":"cancellation","operator":{"type":"string","operation":"equals"}}],"options":{"caseSensitive":false,"leftValue":"","typeValidation":"loose"}}},"id":"if-cancel","name":"Is Cancellation?","type":"n8n-nodes-base.if","typeVersion":2,"position":[600,500]},{"parameters":{"conditions":{"combinator":"and","conditions":[{"id":"cond-if-modify","leftValue":"={{ $json.body.event }}","rightValue":"modification","operator":{"type":"string","operation":"equals"}}],"options":{"caseSensitive":false,"leftValue":"","typeValidation":"loose"}}},"id":"if-modify","name":"Is Modification?","type":"n8n-nodes-base.if","typeVersion":2,"position":[800,600]},{"parameters":{"conditions":{"combinator":"and","conditions":[{"id":"cond-if-reset","leftValue":"={{ $json.body.event }}","rightValue":"password_reset","operator":{"type":"string","operation":"equals"}}],"options":{"caseSensitive":false,"leftValue":"","typeValidation":"loose"}}},"id":"if-reset","name":"Is Password Reset?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1000,700]},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"><meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\"></head>\\n<body style=\\"margin:0;padding:0;background-color:#f4f4f4;font-family:'Helvetica Neue',Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background-color:#f4f4f4;padding:30px 15px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:520px;background-color:#ffffff;border-radius:16px;overflow:hidden;\\">\\n<tr><td style=\\"background:linear-gradient(135deg,#1a1a1a,#2a2a2a);padding:32px 30px;text-align:center;\\">\\n<h1 style=\\"margin:0;color:#d4a855;font-size:22px;font-weight:700;\\">Promemoria Appuntamento</h1>\\n</td></tr>\\n<tr><td style=\\"padding:28px 30px 12px;\\">\\n<p style=\\"margin:0 0 20px;color:#333;font-size:16px;line-height:1.5;\\">Ciao <strong>${d.client_name}</strong>,<br>ti ricordiamo che hai un appuntamento domani!</p>\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background:#faf7f0;border:1px solid #e8dcc4;border-radius:12px;\\">\\n<tr><td style=\\"padding:20px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:8px 0;color:#888;font-size:13px;width:100px;\\">Data</td><td style=\\"padding:8px 0;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Orario</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.service_name}</td></tr>\\n</table></td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:16px 30px;\\">\\n<p style=\\"margin:0;color:#1a1a1a;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:2px 0 0;color:#888;font-size:13px;\\">Via San Biagio 3, Serra San Bruno (VV)</p>\\n</td></tr>\\n<tr><td style=\\"background:#1a1a1a;padding:20px 30px;text-align:center;\\">\\n<p style=\\"margin:0;color:#d4a855;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:4px 0 0;color:#666;font-size:11px;\\">Se non puoi venire, avvisaci il prima possibile.</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-reminder","name":"Build Reminder HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[600,200]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"={{ $json.client_email }}","subject":"Promemoria Appuntamento Domani - Barber 99","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"send-reminder","name":"Send Reminder Email","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[800,200],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"><meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\"></head>\\n<body style=\\"margin:0;padding:0;background-color:#f4f4f4;font-family:'Helvetica Neue',Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background-color:#f4f4f4;padding:30px 15px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:520px;background-color:#ffffff;border-radius:16px;overflow:hidden;\\">\\n<tr><td style=\\"background:linear-gradient(135deg,#4a1a1a,#2a1a1a);padding:32px 30px;text-align:center;\\">\\n<h1 style=\\"margin:0;color:#e74c3c;font-size:22px;font-weight:700;\\">Appuntamento Annullato</h1>\\n</td></tr>\\n<tr><td style=\\"padding:28px 30px 12px;\\">\\n<p style=\\"margin:0 0 20px;color:#333;font-size:16px;line-height:1.5;\\">Ciao <strong>${d.client_name}</strong>,<br>il tuo appuntamento e stato annullato.</p>\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background:#faf7f0;border:1px solid #e8dcc4;border-radius:12px;\\">\\n<tr><td style=\\"padding:20px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:8px 0;color:#888;font-size:13px;width:100px;\\">Data</td><td style=\\"padding:8px 0;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Orario</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.service_name}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Motivo</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#e74c3c;font-size:14px;\\">${d.reason || 'Non specificato'}</td></tr>\\n</table></td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:16px 30px;\\">\\n<p style=\\"margin:0;color:#666;font-size:14px;line-height:1.5;\\">Se desideri prenotare un nuovo appuntamento, visita il nostro sito.</p>\\n</td></tr>\\n<tr><td style=\\"background:#1a1a1a;padding:20px 30px;text-align:center;\\">\\n<p style=\\"margin:0;color:#d4a855;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:4px 0 0;color:#888;font-size:12px;\\">Tel: 327 126 3091</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-cancel","name":"Build Cancel HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[800,350]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"={{ $json.client_email }}","subject":"Appuntamento Annullato - Barber 99","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"send-cancel","name":"Send Cancellation Email","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1000,350],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body || $input.item.json;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"></head>\\n<body style=\\"margin:0;padding:0;background:#f4f4f4;font-family:Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"padding:20px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:480px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid #e0e0e0;\\">\\n<tr><td style=\\"background:#e74c3c;padding:16px 24px;\\">\\n<h2 style=\\"margin:0;color:#fff;font-size:16px;\\">Cancellazione Appuntamento</h2>\\n</td></tr>\\n<tr><td style=\\"padding:20px 24px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;width:80px;\\">Cliente</td><td style=\\"padding:6px 0;font-size:14px;font-weight:600;\\">${d.client_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Telefono</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.client_phone}</td></tr>\\n<tr><td colspan=\\"2\\" style=\\"padding:8px 0;border-top:1px solid #eee;\\"></td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.service_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Data</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Ora</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Motivo</td><td style=\\"padding:6px 0;font-size:14px;color:#e74c3c;\\">${d.reason || 'Non specificato'}</td></tr>\\n</table></td></tr>\\n<tr><td style=\\"background:#f8f8f8;padding:12px 24px;text-align:center;\\">\\n<p style=\\"margin:0;color:#999;font-size:11px;\\">Notifica automatica - Barber 99</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-admin-cancel","name":"Build Admin Cancel HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,350]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"info@barber99.it","subject":"=Cancellazione - {{ $json.client_name }}","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"notify-admin-cancel","name":"Notify Admin Cancellation","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1400,350],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"><meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\"></head>\\n<body style=\\"margin:0;padding:0;background-color:#f4f4f4;font-family:'Helvetica Neue',Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background-color:#f4f4f4;padding:30px 15px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:520px;background-color:#ffffff;border-radius:16px;overflow:hidden;\\">\\n<tr><td style=\\"background:linear-gradient(135deg,#1a1a1a,#2a2a2a);padding:32px 30px;text-align:center;\\">\\n<h1 style=\\"margin:0;color:#3498db;font-size:22px;font-weight:700;\\">Appuntamento Modificato</h1>\\n</td></tr>\\n<tr><td style=\\"padding:28px 30px 12px;\\">\\n<p style=\\"margin:0 0 20px;color:#333;font-size:16px;line-height:1.5;\\">Ciao <strong>${d.client_name}</strong>,<br>il tuo appuntamento e stato aggiornato con i nuovi dettagli:</p>\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background:#faf7f0;border:1px solid #e8dcc4;border-radius:12px;\\">\\n<tr><td style=\\"padding:20px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:8px 0;color:#888;font-size:13px;width:100px;\\">Nuova Data</td><td style=\\"padding:8px 0;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Nuovo Orario</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.service_name}</td></tr>\\n</table></td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:16px 30px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" style=\\"background:#f8f8f8;border-radius:10px;\\">\\n<tr><td style=\\"padding:14px 16px;\\">\\n<p style=\\"margin:0;color:#1a1a1a;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:2px 0 0;color:#888;font-size:13px;\\">Via San Biagio 3, Serra San Bruno (VV)</p>\\n</td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:8px 30px 24px;text-align:center;\\">\\n<a href=\\"${d.cancellationLink || '#'}\\" style=\\"display:inline-block;color:#999;font-size:13px;text-decoration:underline;\\">Devi cancellare? Clicca qui</a>\\n</td></tr>\\n<tr><td style=\\"background:#1a1a1a;padding:20px 30px;text-align:center;\\">\\n<p style=\\"margin:0;color:#d4a855;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:4px 0 0;color:#888;font-size:12px;\\">Tel: 327 126 3091</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-modify","name":"Build Modify HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1000,500]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"={{ $json.client_email }}","subject":"Appuntamento Modificato - Barber 99","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"send-modify","name":"Send Modification Email","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1200,500],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body || $input.item.json;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"></head>\\n<body style=\\"margin:0;padding:0;background:#f4f4f4;font-family:Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"padding:20px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:480px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid #e0e0e0;\\">\\n<tr><td style=\\"background:#3498db;padding:16px 24px;\\">\\n<h2 style=\\"margin:0;color:#fff;font-size:16px;\\">Appuntamento Modificato</h2>\\n</td></tr>\\n<tr><td style=\\"padding:20px 24px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;width:80px;\\">Cliente</td><td style=\\"padding:6px 0;font-size:14px;font-weight:600;\\">${d.client_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Telefono</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.client_phone}</td></tr>\\n<tr><td colspan=\\"2\\" style=\\"padding:8px 0;border-top:1px solid #eee;\\"></td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:6px 0;font-size:14px;font-weight:600;\\">${d.service_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Nuova Data</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Nuovo Ora</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.time}</td></tr>\\n</table></td></tr>\\n<tr><td style=\\"background:#f8f8f8;padding:12px 24px;text-align:center;\\">\\n<p style=\\"margin:0;color:#999;font-size:11px;\\">Notifica automatica - Barber 99</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-admin-modify","name":"Build Admin Modify HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1400,500]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"info@barber99.it","subject":"=Modifica - {{ $json.client_name }}","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"notify-admin-modify","name":"Notify Admin Modification","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1600,500],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"><meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\"></head>\\n<body style=\\"margin:0;padding:0;background-color:#f4f4f4;font-family:'Helvetica Neue',Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background-color:#f4f4f4;padding:30px 15px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:520px;background-color:#ffffff;border-radius:16px;overflow:hidden;\\">\\n<tr><td style=\\"background:linear-gradient(135deg,#1a1a1a,#2a2a2a);padding:32px 30px;text-align:center;\\">\\n<h1 style=\\"margin:0;color:#d4a855;font-size:22px;font-weight:700;\\">Reimposta Password</h1>\\n</td></tr>\\n<tr><td style=\\"padding:28px 30px 12px;\\">\\n<p style=\\"margin:0 0 20px;color:#333;font-size:16px;line-height:1.5;\\">Ciao <strong>${d.client_name}</strong>,<br>hai richiesto di reimpostare la password del tuo account.</p>\\n<p style=\\"margin:0 0 24px;color:#666;font-size:14px;line-height:1.5;\\">Clicca il pulsante qui sotto per scegliere una nuova password. Il link scade tra 1 ora.</p>\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\">\\n<tr><td align=\\"center\\" style=\\"padding:8px 0 24px;\\">\\n<a href=\\"${d.resetLink}\\" style=\\"display:inline-block;background:linear-gradient(135deg,#d4a855,#b8923f);color:#0c0c0c;font-weight:700;font-size:16px;padding:14px 36px;border-radius:10px;text-decoration:none;\\">Reimposta Password</a>\\n</td></tr></table>\\n<p style=\\"margin:0;color:#999;font-size:12px;\\">Se non hai richiesto il reset, ignora questa email.</p>\\n</td></tr>\\n<tr><td style=\\"background:#1a1a1a;padding:20px 30px;text-align:center;\\">\\n<p style=\\"margin:0;color:#d4a855;font-size:14px;font-weight:600;\\">Barber 99</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-reset","name":"Build Reset HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,650]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"={{ $json.client_email }}","subject":"Reimposta la tua Password - Barber 99","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"send-reset","name":"Send Reset Email","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1400,650],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"><meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\"></head>\\n<body style=\\"margin:0;padding:0;background-color:#f4f4f4;font-family:'Helvetica Neue',Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background-color:#f4f4f4;padding:30px 15px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:520px;background-color:#ffffff;border-radius:16px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,0.08);\\">\\n<tr><td style=\\"background:linear-gradient(135deg,#1a1a1a,#2a2a2a);padding:32px 30px;text-align:center;\\">\\n<h1 style=\\"margin:0;color:#d4a855;font-size:22px;font-weight:700;\\">Prenotazione Confermata</h1>\\n</td></tr>\\n<tr><td style=\\"padding:28px 30px 12px;\\">\\n<p style=\\"margin:0 0 20px;color:#333;font-size:16px;line-height:1.5;\\">Ciao <strong>${d.client_name}</strong>,<br>il tuo appuntamento e stato confermato!</p>\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"background:#faf7f0;border:1px solid #e8dcc4;border-radius:12px;\\">\\n<tr><td style=\\"padding:20px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:8px 0;color:#888;font-size:13px;width:100px;\\">Data</td><td style=\\"padding:8px 0;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Orario</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;font-weight:600;\\">${d.service_name}</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Durata</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#1a1a1a;font-size:15px;\\">${d.duration} minuti</td></tr>\\n<tr><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#888;font-size:13px;\\">Prezzo</td><td style=\\"padding:8px 0;border-top:1px solid #e8dcc4;color:#d4a855;font-size:17px;font-weight:700;\\">${d.price}</td></tr>\\n</table></td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:16px 30px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" style=\\"background:#f8f8f8;border-radius:10px;\\">\\n<tr><td style=\\"padding:14px 16px;\\">\\n<p style=\\"margin:0;color:#1a1a1a;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:2px 0 0;color:#888;font-size:13px;\\">Via San Biagio 3, Serra San Bruno (VV)</p>\\n</td></tr></table>\\n</td></tr>\\n<tr><td style=\\"padding:8px 30px 24px;text-align:center;\\">\\n<a href=\\"${d.cancellationLink}\\" style=\\"display:inline-block;color:#999;font-size:13px;text-decoration:underline;\\">Devi cancellare? Clicca qui</a>\\n</td></tr>\\n<tr><td style=\\"background:#1a1a1a;padding:20px 30px;text-align:center;\\">\\n<p style=\\"margin:0;color:#d4a855;font-size:14px;font-weight:600;\\">Barber 99</p>\\n<p style=\\"margin:4px 0 0;color:#888;font-size:12px;\\">Tel: 327 126 3091</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-confirm","name":"Build Confirm HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,800]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"={{ $json.client_email }}","subject":"Conferma Appuntamento - Barber 99","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"send-confirm","name":"Send Confirmation Email","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1400,800],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}},{"parameters":{"jsCode":"\\nconst d = $input.item.json.body || $input.item.json;\\nconst html = `<!DOCTYPE html><html lang=\\"it\\"><head><meta charset=\\"utf-8\\"></head>\\n<body style=\\"margin:0;padding:0;background:#f4f4f4;font-family:Arial,sans-serif;\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"padding:20px;\\">\\n<tr><td align=\\"center\\">\\n<table role=\\"presentation\\" width=\\"100%\\" cellpadding=\\"0\\" cellspacing=\\"0\\" style=\\"max-width:480px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid #e0e0e0;\\">\\n<tr><td style=\\"background:#d4a855;padding:16px 24px;\\">\\n<h2 style=\\"margin:0;color:#1a1a1a;font-size:16px;\\">Nuova Prenotazione</h2>\\n</td></tr>\\n<tr><td style=\\"padding:20px 24px;\\">\\n<table role=\\"presentation\\" width=\\"100%\\">\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;width:80px;\\">Cliente</td><td style=\\"padding:6px 0;font-size:14px;font-weight:600;\\">${d.client_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Email</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.client_email || '-'}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Telefono</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.client_phone}</td></tr>\\n<tr><td colspan=\\"2\\" style=\\"padding:8px 0;border-top:1px solid #eee;\\"></td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Servizio</td><td style=\\"padding:6px 0;font-size:14px;font-weight:600;\\">${d.service_name}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Data</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.date}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Ora</td><td style=\\"padding:6px 0;font-size:14px;\\">${d.time}</td></tr>\\n<tr><td style=\\"padding:6px 0;color:#888;font-size:13px;\\">Prezzo</td><td style=\\"padding:6px 0;font-size:14px;color:#d4a855;font-weight:700;\\">${d.price || '-'}</td></tr>\\n</table></td></tr>\\n<tr><td style=\\"background:#f8f8f8;padding:12px 24px;text-align:center;\\">\\n<p style=\\"margin:0;color:#999;font-size:11px;\\">Notifica automatica - Barber 99</p>\\n</td></tr></table></td></tr></table></body></html>`;\\nreturn { json: { ...d, htmlBody: html } };\\n","mode":"runOnceForEachItem"},"id":"code-admin-notify","name":"Build Admin Notify HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[1600,800]},{"parameters":{"fromEmail":"info@barber99.it","toEmail":"info@barber99.it","subject":"=Nuova Prenotazione - {{ $json.client_name }}","emailType":"html","html":"={{ $json.htmlBody }}"},"id":"notify-admin","name":"Notify Admin","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1800,800],"credentials":{"smtp":{"id":"barber99smtp01","name":"Hostinger SMTP - Barber99"}}}],"connections":{"Webhook": {"main": [[{"node": "Is Reminder?", "type": "main", "index": 0}]]}, "Is Reminder?": {"main": [[{"node": "Build Reminder HTML", "type": "main", "index": 0}], [{"node": "Is Cancellation?", "type": "main", "index": 0}]]}, "Build Reset HTML": {"main": [[{"node": "Send Reset Email", "type": "main", "index": 0}]]}, "Is Cancellation?": {"main": [[{"node": "Build Cancel HTML", "type": "main", "index": 0}], [{"node": "Is Modification?", "type": "main", "index": 0}]]}, "Is Modification?": {"main": [[{"node": "Build Modify HTML", "type": "main", "index": 0}], [{"node": "Is Password Reset?", "type": "main", "index": 0}]]}, "Build Cancel HTML": {"main": [[{"node": "Send Cancellation Email", "type": "main", "index": 0}, {"node": "Build Admin Cancel HTML", "type": "main", "index": 0}]]}, "Build Modify HTML": {"main": [[{"node": "Send Modification Email", "type": "main", "index": 0}, {"node": "Build Admin Modify HTML", "type": "main", "index": 0}]]}, "Build Confirm HTML": {"main": [[{"node": "Send Confirmation Email", "type": "main", "index": 0}, {"node": "Build Admin Notify HTML", "type": "main", "index": 0}]]}, "Is Password Reset?": {"main": [[{"node": "Build Reset HTML", "type": "main", "index": 0}], [{"node": "Build Confirm HTML", "type": "main", "index": 0}]]}, "Build Reminder HTML": {"main": [[{"node": "Send Reminder Email", "type": "main", "index": 0}]]}, "Build Admin Cancel HTML": {"main": [[{"node": "Notify Admin Cancellation", "type": "main", "index": 0}]]}, "Build Admin Modify HTML": {"main": [[{"node": "Notify Admin Modification", "type": "main", "index": 0}]]}, "Build Admin Notify HTML": {"main": [[{"node": "Notify Admin", "type": "main", "index": 0}]]}},"createdAt":"2026-02-09T17:37:56.556+00:00","updatedAt":"2026-02-09T17:57:15.13+00:00","settings":{"availableInMCP": true, "executionOrder": "v1"},"staticData":null,"pinData":null,"versionId":"ac45baaf-f661-4d41-be64-2cb7e4763aa2","triggerCount":1,"id":"cuXmEsNFqLQxGQyZ","meta":null,"parentFolderId":null,"isArchived":false,"versionCounter":17,"description":null,"activeVersionId":"4578c89d-ff52-49ca-8070-d951a9ead57f"}
